# Timekeeper

Timekeeper is a web app built with [ReactJS](https://reactjs.org/), [ExpressJS](https://expressjs.com/), [Sequelize](https://sequelize.org/master/index.html), and [PostgreSQL](https://www.postgresql.org/).

This project is part of the **Tubesoft** application process.

### Overview

The app consists of a stopwatch. The user can start, pause, resume and finish the timer. When the timer is finished, the current time is persisted in the DB and showed to the user.

Each of the different services, client, server, and database, is an independent [Docker](https://docs.docker.com/) container. The whole project is run with the [Docker Compose](https://docs.docker.com/compose/) tool. Also, automated testing was implemented in both client and the server. The [Jest](https://jestjs.io/) was used to implement all the test suites, along with some utility libraries such as Supertest and React Testing Library.

### Folders structure

```
â”œâ”€ğŸ“ client
â”‚  â”œâ”€ğŸ“ build
â”‚  â”œâ”€ğŸ“ coverage
â”‚  â”œâ”€ğŸ“ node_modules
â”‚  â”œâ”€ğŸ“ public
â”‚  â”œâ”€ğŸ“ src
â”‚  â”œâ”€ğŸ“„ .dockerignore
â”‚  â”œâ”€ğŸ“„ .eslintrc
â”‚  â”œâ”€ğŸ“„ Dockerfile
â”‚  â”œâ”€ğŸ“„ package-lock.json
â”‚  â””â”€ğŸ“„ package.json
â”œâ”€ğŸ“ server
â”‚  â”œâ”€ğŸ“ node_modules
â”‚  â”œâ”€ğŸ“ scripts
â”‚  â”œâ”€ğŸ“ src
â”‚  â”œâ”€ğŸ“ tests
â”‚  â”œâ”€ğŸ“„ .dockerignore
â”‚  â”œâ”€ğŸ“„ .sequelizerc
â”‚  â”œâ”€ğŸ“„ Dockerfile
â”‚  â”œâ”€ğŸ“„ package-lock.json
â”‚  â””â”€ğŸ“„ package.json
â”œâ”€ğŸ“„ .env
â”œâ”€ğŸ“„ .env.test
â”œâ”€ğŸ“„ .gitignore
â”œâ”€ğŸ“„ docker-compose.yml
â””â”€ğŸ“„ README
```

The `/client` folder contains the frontend app built with ReactJS. The test files are next to their respective files. The `/coverage` folder is the output generated by Jest after running the tests. The code itself lives in `/src`.

The `/server` folder contains the backend app built with ExpressJS. It exposes a 2 endpoints: `/register_time` and `/health_check`. The former receives a POST request with the time registered by the client and then stores it in the database. The latter is only a utility to check the state of the service during the Docker Compose build. `/scripts` holds a bunch of Bash files to automate the different pipelines. Concretely, they allow the starting up of the server and automated testing. The coverage output lives in `/tests` folders, along with `/integration` and `/unit`.

Each folder has a `Dockerfile` defining the images to be used by the root-level `docker-compose.yml`. This file will build and run the 3 services: a Postgres database, the server, and the client. To do it, it'll use the values set in the `.env` file (by default) or `.env.test`, depending on the current environment.

### Setup

Because this project depends on the [Docker engine](https://docs.docker.com/engine/) and [Docker Compose](https://docs.docker.com/compose/install/), these technologies are required. On the other hand, for development, all the other tools would be required.

### Run

Build the images and run all the containers jointly: `docker-compose up`.

Tear down the containers: `docker-compose down`.

Visit http://localhost:5000 to see the app.

Use the following settings to inspect the database:

- Hostname: **localhost**
- Port: **2345**
- Database name: **timekeeper_db**
- Username: **postgres**
- Password: **password**

During development, tune the setting in `server/src/config/db_config.js` and the different `.env` files. Note that a random port **2345** has been used to avoid potential conflict with running instances.

### Test

The test suites run independently. To run the client's tests, navigate to `/client` and run `npm test`. To run the server's tests, two options are provided:

1. Run tests locally with `npm run local-test`. This will require a running database against which to run the integration tests.
2. (Recommended) Create a database on the fly and run the tests with `npm run docker-test`. A Postgres container will be build using the `docker-compose.yml` file and will be torn down after running the tests.

In both cases, a coverage summary will be output in the terminal.

### Summary

#####  Run the app:
```
docker-compose up
```
##### Tear down containers:
```
docker-compose down
```
##### Run client tests:
```
cd client && npm test
```
##### Run server tests:

(Recommended)
```
cd server && npm run docker-test
```
or
```
cd server && npm run local-test
```
